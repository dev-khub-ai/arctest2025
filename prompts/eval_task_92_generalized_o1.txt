System Prompt: Row-Based / Compressed Re-Arrangement Puzzles
You are solving a type of puzzle in which the input grid is rearranged by removing certain rows (sometimes entire columns or shapes), then “sliding” or “compressing” the remaining rows downward. The puzzle preserves connected clusters (4-connected pixels of the same color) in shape and adjacency, while discarding others deemed unneeded. Sometimes there is a special “indicator pixel” that influences which clusters or rows are kept, but its location or function may vary.

1. Identifying This Puzzle Type
Look for these distinctive signs:

The final output discards entire rows that do not contribute to a final structure.

The remaining rows are shifted or “compressed” down toward the bottom (or sometimes kept in a contiguous block).

Shapes (clusters of color) that remain do not change their internal 4-connected shape horizontally; they only move vertically as a group or remain in place.

A “metadata” pixel might appear (often near the top-left, but not necessarily). It can serve as a puzzle ID or an “indicator color” telling you which clusters matter most – or it can simply remain unchanged in the final output.

When you see these features, you can retrieve and apply this rule.

2. Detect & Keep Required Rows
Scan all rows from top to bottom.

For each row, decide if it contains or “supports” a shape or cluster you need in the final arrangement.

If it is entirely irrelevant (no part of the puzzle’s final shape), you may remove it entirely.

Otherwise, keep it.

If you see a puzzle “indicator pixel” or color used to select certain clusters, figure out how the puzzle logic includes or excludes other pixels based on that color. Sometimes other colors remain as well, especially if they form a larger shape that’s being preserved.

3. Identify and Preserve Clusters
Use 4-connectivity (up, down, left, right) to detect clusters of colored pixels.

Each cluster must remain internally consistent:

Do not split it apart or combine it with a different cluster.

Retain the same shape of adjacency.

4. Removal of Unused Clusters
Some tasks remove “floating” or “unused” clusters (colors that do not connect to the puzzle’s main shape). If the puzzle logic indicates such clusters are to be discarded, do not carry them into the final output. Otherwise, keep them but still shift them vertically if needed.

5. Sliding Rows Down
Once you know which rows remain:

“Slide” or “compress” the kept rows downward so there are no fully removed rows in between.

The vertical order of these kept rows remains the same (the puzzle does not reorder them arbitrarily), but you fill in any gaps of removed rows so the final arrangement is contiguous.

6. Handling Special “Indicator Pixels”
Sometimes, a pixel at a certain position (like (1,1), but not always) serves a special function:

It might define the “key color” or puzzle ID.

It might remain unchanged in the final arrangement, or determine which rows/clusters are valid.

If you detect such a puzzle from the training data, do not remove or alter the indicator pixel’s location or color. Copy it exactly from input to output.

7. Final Output
Typically, you produce the same size grid (e.g., 12×12).

Rows that are removed become zeros.

Rows that remain are moved down to fill any empty row gaps.

Clusters preserve shape and adjacency.

Any special indicator or top-left pixel is left as is.

8. Verification
Always verify row by row:

Check that each row’s final arrangement and the color clusters (including shape and adjacency) match the official puzzle output.

If the puzzle’s official output discards certain clusters or partial rows, be sure to replicate that exact logic.

How to Use
Any time you see a puzzle in which entire rows are discarded, shapes are preserved and slid downward, and possibly there is a pixel that influences which clusters remain, retrieve and apply this “Row-Based / Compressed Re-Arrangement” approach. Make sure to confirm whether the puzzle demands partial shapes from other colors to remain or not, and adapt accordingly.
